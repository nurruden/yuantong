{% extends 'base.html' %}

{% block head_extra %}
{% load static %}
<link href="{% static 'libs/material-icons/material-icons.css' %}" rel="stylesheet">
<script src="{% static 'js/utils.js' %}"></script>
<script src="{% static 'js/system/product_model.js' %}" defer></script>
<!-- 确保不加载admin.js，避免冲突 -->
{% endblock %}

{% block content %}
<div class="app-container">
    <div class="header">
            <div class="user-info">
            <span class="material-icons" data-icon="person">person</span>
                <span class="username">{{ user.first_name }}</span>
                {% if user.last_name %}
                    <span class="department">({{ user.last_name }})</span>
                {% endif %}
        </div>
        <a href="{% url 'logout' %}" class="logout-btn">
            <span class="material-icons" data-icon="logout">logout</span>
            退出登录
        </a>
    </div>
    <div class="main-container">
        <div id="sideMenu" class="side-menu">
            {% include 'shared/sidebar.html' %}
        </div>
        <div class="main-content" id="mainContentArea">
            <div class="admin-panel-container">
                <div class="admin-panel">
                    <div class="panel-header">
                        <h2>产品型号列表</h2>
                        <div class="action-bar">
                            <button class="btn btn-primary" onclick="showAddProductModelModal()">
                                <span class="material-icons">add</span> 新增产品型号
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>产品型号名称</th>
                                    <th>创建时间</th>
                                    <th>更新时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="productModelTableBody">
                                <!-- 数据将通过JavaScript动态加载 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 产品型号模态框 -->
<div id="productModelModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="productModelModalTitle">新增产品型号</h3>
            <button type="button" class="close" onclick="closeProductModelModal()">&times;</button>
        </div>
            <div class="modal-body">
                <div class="form-group">
                <label for="productModelName">产品型号名称</label>
                <input type="text" id="productModelName" class="form-control" placeholder="请输入产品型号名称">
            </div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeProductModelModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveProductModel()">保存</button>
            </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 防止admin.js冲突的全局变量
window.PRODUCT_MODEL_PAGE = true;

// 确保页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    console.log('产品型号页面初始化开始...');
    
    // 检查必要的元素是否存在
    const productModelTableBody = document.getElementById('productModelTableBody');
    if (!productModelTableBody) {
        console.error('产品型号表格元素未找到');
        return;
    }
    
    // 初始化产品型号功能
    if (typeof loadProductModels === 'function') {
        loadProductModels();
    } else {
        console.error('loadProductModels函数未定义');
    }
    
    console.log('产品型号页面初始化完成');
});

// 错误处理函数
window.addEventListener('error', function(e) {
    console.error('JavaScript错误:', e.error);
    console.error('错误位置:', e.filename, e.lineno, e.colno);
});

// 未捕获的Promise错误处理
window.addEventListener('unhandledrejection', function(e) {
    console.error('未处理的Promise错误:', e.reason);
});
</script>

<style>
/* 修复transform属性问题 */
.material-icons {
    transform: none !important;
}

/* 确保模态框正常工作 */
.modal {
    z-index: 1055 !important;
}

.modal-backdrop {
    z-index: 1050 !important;
}

.modal-dialog {
    z-index: 1055 !important;
}

/* 页面样式 */
.admin-panel { 
    background: white; 
    border-radius: 8px; 
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
    margin-bottom: 20px; 
    overflow: hidden; 
}

.panel-header { 
    padding: 20px; 
    border-bottom: 1px solid #eee; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
}

.panel-header h2 { 
    margin: 0; 
    font-size: 18px; 
    color: #333; 
}

.action-bar { 
    display: flex; 
    gap: 10px; 
}

.table-responsive { 
    overflow-x: auto; 
    -webkit-overflow-scrolling: touch; 
}

.data-table { 
    width: 100%; 
    border-collapse: collapse; 
    min-width: 800px; 
}

.data-table th, .data-table td { 
    padding: 12px 16px; 
    text-align: left; 
    border-bottom: 1px solid #eee; 
}

.data-table th { 
    background: #f5f5f5; 
    font-weight: 500; 
    color: #333; 
}

.data-table tr:hover { 
    background: #f9f9f9; 
}

.btn { 
    display: inline-flex; 
    align-items: center; 
    justify-content: center; 
    padding: 8px 16px; 
    border: none; 
    border-radius: 4px; 
    font-size: 14px; 
    font-weight: 500; 
    cursor: pointer; 
    text-decoration: none; 
    transition: all 0.3s ease; 
}

.btn-primary { 
    background: linear-gradient(90deg, #81d4fa 0%, #a5d6a7 100%); 
    color: #fff; 
}

.btn-primary:hover { 
    background: linear-gradient(90deg, #4fc3f7 0%, #66bb6a 100%); 
    transform: translateY(-1px); 
}

.btn-danger { 
    background: #ff5252; 
    color: #fff; 
}

.btn-danger:hover { 
    background: #ff1744; 
    transform: translateY(-1px); 
}

.btn-sm { 
    padding: 4px 8px; 
    font-size: 12px; 
}

.material-icons { 
    font-size: 18px; 
    margin-right: 4px; 
}

.modal { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0, 0, 0, 0.5); 
    z-index: 1000; 
}

.modal-content { 
    position: relative; 
    background: white; 
    width: 90%; 
    max-width: 500px; 
    margin: 50px auto; 
    padding: 20px; 
    border-radius: 8px; 
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
}

.modal-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 20px; 
}

.modal-header h3 { 
    margin: 0; 
    font-size: 18px; 
    color: #333; 
}

.close { 
    background: none; 
    border: none; 
    font-size: 24px; 
    color: #666; 
    cursor: pointer; 
    padding: 0; 
}

.form-group { 
    margin-bottom: 15px; 
}

.form-group label { 
    display: block; 
    margin-bottom: 5px; 
    color: #333; 
    font-weight: 500; 
}

.form-control { 
    width: 100%; 
    padding: 8px 12px; 
    border: 1px solid #ddd; 
    border-radius: 4px; 
    font-size: 14px; 
}

.form-control:focus { 
    border-color: #81d4fa; 
    outline: none; 
    box-shadow: 0 0 0 2px rgba(129, 212, 250, 0.2); 
}

.form-actions { 
    display: flex; 
    justify-content: flex-end; 
    gap: 10px; 
    margin-top: 20px; 
}

.btn-secondary { 
    background: #e0e0e0; 
    color: #333; 
}

.btn-secondary:hover { 
    background: #bdbdbd; 
}
</style>
{% endblock %} 